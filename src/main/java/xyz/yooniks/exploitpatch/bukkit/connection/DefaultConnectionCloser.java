package xyz.yooniks.exploitpatch.bukkit.connection;

import java.util.HashSet;
import java.util.Set;
import java.util.UUID;
import org.bukkit.entity.Player;
import org.bukkit.plugin.Plugin;

public class DefaultConnectionCloser implements ConnectionCloser {

  private final Set<UUID> toDisconnect = new HashSet<>();
  private final Plugin plugin;
  private final String kickMessage;

  public DefaultConnectionCloser(Plugin plugin, String kickMessage) {
    this.plugin = plugin;
    this.kickMessage = kickMessage;
  }

  @Override
  public void close(Player player) {
    final UUID uuid = player.getUniqueId();
    if (this.toDisconnect.contains(uuid)) {
      return;
    }
    this.toDisconnect.add(uuid);
    this.plugin.getServer().getScheduler()
        .runTask(this.plugin, () -> {
          //this.plugin.getServer().banIP(player.getAddress().getHostString());
          player.kickPlayer(this.kickMessage);
          this.toDisconnect.remove(uuid);
        });
  }

  @Override
  public boolean isClosing(Player player) {
    return this.toDisconnect.contains(player.getUniqueId());
  }

}
